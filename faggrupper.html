<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/style.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/locale/nb.js"></script>
    <title>Faggrupper</title>
  </head>

  <body class="faggrupper">
    <div>
      <div class="logo-absolute-right">
        <img
          class="logo"
          src="/assets/soprasterialogo.svg"
          alt="Sopra Steria logo"
        />
      </div>
      <h2 class="date-logo"></h2>
    </div>
    <h4 class="faggruppe"></h4>
    <div class="date"></div>
    <h2 class="theme"></h2>

    <div class="next-event">
      <h6>Neste arrangement:</h6>
        <h6 class="next-event-title"></h6>
        <h6 class="next-event-date"></h6>
    </div>
  </body>

  <script>
    let data = {
      events: [
        {
          start: "2020-02-04T16:30",
          end: "2020-02-04T19:00",
          title: "Grafisk design",
          description: "Hvem, hva, hvor, hvordan, hvorfor - AKA designerens toolkit. \n \n Vi har alle ulike utfordringer fra tid til annen når vi starter i et prosjekt. Hva betyr disse utfordringene for oss og hvor vi kommer inn i prosessen – og hvordan kan vi begynne å ta tak i arbeidsoppgaver?",
        },
        {
          start: "2020-02-06T16:30",
          end: "2020-02-06T18:00",
          title: "Avdelingsmøte design",
          description:
            "Velkommen til avdelingsmøte! Agenda kommer så snart den er satt. \n \n Hilsen Ingunn"
        },
        {
          start: "2020-02-18T16:30",
          end: "2020-02-18T17:30",
          title: "Bokbad - design",
          description: "Ruined by Design av Mike Monteiro. \n \n Oppmøte på Kulturhuset."
        },
        {
          start: "2020-02-12T16:30",
          end: "2020-02-12T19:00",
          title: "Tjenestedesign",
          description: "Agenda kommer"
        },
        {
          start: "2020-02-25T16:30",
          end: "2020-02-25T19:00",
          title: "Industridesign",
          description: "Agenda kommer"
        },
        {
          start: "2020-02-27T16:30",
          end: "2020-02-27T19:00",
          title: "Interaksjonsdesign",
          description: "Agenda kommer"
        }
      ]
    };

    let now = new Date();
    function isOver(event) {
      return now > event.end;
    }

    function pickNext(events, exclude) {
      // The same algorithm (function) is used to pick both first and next
      // It can be described as:
      // Do not pick the event sent as exclude argument, or any event before
      // Always prefer events which are not done
      // Prefer events that are closer to current time
      //
      // Handles a few edge cases, like:
      // - If there are 0 events, pick nothing (return null)
      // - If there is 1 event, it will be the first event and no next
      // - If all events are done, first event will be the one which started
      //   last and next will be null
      let bestSoFar = null;
      for (let event of events) {
        if (
          exclude != null &&
          (exclude === event || event.start < exclude.start)
        ) {
          // Skip the excluded (previously picked) event, and all events
          // before it.
        } else if (bestSoFar === null) {
          // If we haven't picked anything, pick this event
          // (the first event as long as there are more than 0)
          bestSoFar = event;
        } else if (isOver(event) && !isOver(bestSoFar)) {
          // if this event has ended and the one we picked hasn't
          // skip this one
        } else if (!isOver(event) && isOver(bestSoFar)) {
          // if this event has not ended and the one we picked has
          // pick this one instead
          bestSoFar = event;
        } else if (
          isOver(event) &&
          isOver(bestSoFar) &&
          event.start > bestSoFar.start
        ) {
          // If both events are over and this one started later,
          // pick this one
          bestSoFar = event;
        } else if (
          !isOver(event) &&
          !isOver(bestSoFar) &&
          event.start < bestSoFar.start
        ) {
          // If both events are not over and this one starts before,
          // pick this one
          bestSoFar = event;
        }
      }
      return bestSoFar;
    }

    let events = data["events"];
    let firstEvent = pickNext(events, null);
    let nextEvent = pickNext(events, firstEvent);

    if (firstEvent != null) {
      let faggruppe = document.querySelector(".faggruppe");
      faggruppe.innerText = firstEvent.title;

      let date = document.querySelector(".date");
      date.innerText = moment(firstEvent.start).format("LLLL");

      let date_logo = document.querySelector(".date-logo");
      let start = moment(firstEvent.start).format("LLLL");
      let end = moment(firstEvent.end).format("LT");
      date_logo.innerText = start + "-" + end;

      let theme = document.querySelector(".theme");
      theme.innerText = firstEvent.description;
    }

    if (nextEvent != null) {
      let next_event_title = document.querySelector(".next-event-title");
      next_event_title.innerText = nextEvent.title;

      let next_event_date = document.querySelector(".next-event-date");
      next_event_date.innerText = moment(nextEvent.start).format("LLLL");
    }
  </script>
</html>