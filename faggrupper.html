<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/style.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/locale/nb.js"></script>
    <title>Faggrupper</title>
  </head>

  <body class="faggrupper">
    <div>
      <div class="logo-absolute-right">
        <img
          class="logo"
          src="/assets/soprasterialogo.svg"
          alt="Sopra Steria logo"
        />
      </div>
      <h2 class="date-logo">
        <!-- <h2 id="displayMoment" onload="tid()"></h2> -->
      </h2>
    </div>
    <img
      class="logo-mobile"
      src="/assets/soprasterialogo.svg"
      alt="Sopra Steria logo"
    />
    <h4 class="faggruppe"></h4>
    <div class="date-mobile"></div>
    <h2 class="theme"></h2>

    <h2 class="next-event">
      <h2 class="color">
        Neste arrangement:
        <h2 class="next-event-title"></h2>
        <h2 class="next-event-date"></h2>
      </h2>
    </h2>
  </body>
  <!-- <script src="/faggruppe.js"></script> -->
  <!-- <script type="text/javascript" src="innhold.json"></script> -->
  <script>
    let data = {
      events: [
        {
          start: "2020-02-04T16:30",
          end: "2020-02-04T19:00",
          title: "Grafisk design",
          description: "Agenda kommer.."
        },
        {
          start: "2020-02-06T16:30",
          end: "2020-02-06T19:00",
          title: "Avdelingsmøte design",
          description:
            "Velkommen til avdelingsmøte! Agenda kommer så snart den er satt. Hilsen Ingunn"
        },
        {
          start: "2020-03-06T16:30",
          end: "2020-03-06T19:00",
          title: "Fest",
          description: ""
        },
        {
          start: "2020-03-07T16:30",
          end: "2020-03-07T19:00",
          title: "Fest2",
          description: ""
        },
        {
          start: "2020-03-08T16:30",
          end: "2020-03-08T19:00",
          title: "Fest3",
          description: ""
        }
      ]
    };

    let now = new Date();
    function isOver(event) {
      return now > event.end;
    }

    function pickNext(events, exclude) {
      // The same algorithm (function) is used to pick both first and next
      // It can be described as:
      // Do not pick the event sent as exclude argument, or any event before
      // Always prefer events which are not done
      // Prefer events that are closer to current time
      //
      // Handles a few edge cases, like:
      // - If there are 0 events, pick nothing (return null)
      // - If there is 1 event, it will be the first event and no next
      // - If all events are done, first event will be the one which started
      //   last and next will be null
      let bestSoFar = null;
      for (let event of events) {
        if (
          exclude != null &&
          (exclude === event || event.start < exclude.start)
        ) {
          // Skip the excluded (previously picked) event, and all events
          // before it.
        } else if (bestSoFar === null) {
          // If we haven't picked anything, pick this event
          // (the first event as long as there are more than 0)
          bestSoFar = event;
        } else if (isOver(event) && !isOver(bestSoFar)) {
          // if this event has ended and the one we picked hasn't
          // skip this one
        } else if (!isOver(event) && isOver(bestSoFar)) {
          // if this event has not ended and the one we picked has
          // pick this one instead
          bestSoFar = event;
        } else if (
          isOver(event) &&
          isOver(bestSoFar) &&
          event.start > bestSoFar.start
        ) {
          // If both events are over and this one started later,
          // pick this one
          bestSoFar = event;
        } else if (
          !isOver(event) &&
          !isOver(bestSoFar) &&
          event.start < bestSoFar.start
        ) {
          // If both events are not over and this one starts before,
          // pick this one
          bestSoFar = event;
        }
      }
      return bestSoFar;
    }

    let events = data["events"];
    let firstEvent = pickNext(events, null);
    let nextEvent = pickNext(events, firstEvent);

    document.querySelector(".faggruppe").innerText = firstEvent.title;
    document.querySelector(".date-mobile").innerText = moment(
      firstEvent.start
    ).format("LLL");
    document.querySelector(".date-logo").innerText =
      moment(firstEvent.start).format("LLL") +
      "-" +
      moment(firstEvent.end).format("LT");
    document.querySelector(".theme").innerText = firstEvent.description;

    document.querySelector(".next-event-title").innerText = nextEvent.title;
    document.querySelector(".next-event-date").innerText = moment(
      nextEvent.start
    ).calendar();
  </script>
</html>
